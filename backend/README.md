# AI èŠå¤©æ©Ÿå™¨äººå¾Œç«¯æœå‹™

æœ¬ç›®éŒ„åŒ…å« DCKA èª²ç¨‹æ–‡ä»¶ç¶²ç«™çš„ AI èŠå¤©æ©Ÿå™¨äººå¾Œç«¯æœå‹™ï¼Œä½¿ç”¨ FastAPI å»ºç½®ä¸¦æ•´åˆ Google Gemini APIã€‚

![AI Assistant èŠå¤©è¦–çª—](../docs/images/chatbot_window.png)

---

## ğŸ“Œ ç‚ºä»€éº¼éœ€è¦å¾Œç«¯æœå‹™ï¼Ÿ

ç›´æ¥åœ¨å‰ç«¯å‘¼å« Gemini API æœƒå°è‡´ **API Key å¤–æ´©**ï¼Œå› ç‚ºï¼š

1. JavaScript ç¨‹å¼ç¢¼å¯åœ¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·ä¸­è¢«æª¢è¦–
2. API Key ä¸€æ—¦å¤–æ´©ï¼Œå¯èƒ½è¢«æ¿«ç”¨ç”¢ç”Ÿé«˜é¡è²»ç”¨
3. ç„¡æ³•æ§åˆ¶èª°å¯ä»¥ä½¿ç”¨ä½ çš„ API é…é¡

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå»ºç«‹å¾Œç«¯ Proxy æœå‹™ï¼Œå°‡ API Key å®‰å…¨åœ°å­˜æ”¾åœ¨ä¼ºæœå™¨ç«¯ã€‚

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ä½¿ç”¨è€…ç€è¦½å™¨                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ 1. è¨ªå• GitHub Pages
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GitHub Pages (å‰ç«¯éœæ…‹ç¶²ç«™)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  MkDocs     â”‚  â”‚ chatbot.js  â”‚  â”‚ chatbot.css â”‚                     â”‚
â”‚  â”‚  HTML é é¢  â”‚  â”‚  èŠå¤©é‚è¼¯   â”‚  â”‚  èŠå¤©æ¨£å¼   â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ 2. POST /api/chat
                                    â”‚    (å‚³é€èŠå¤©è¨Šæ¯)
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Railway (å¾Œç«¯ API æœå‹™)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  FastAPI (chat_server.py)                               â”‚           â”‚
â”‚  â”‚  - æ¥æ”¶å‰ç«¯è«‹æ±‚                                          â”‚           â”‚
â”‚  â”‚  - çµ„åˆå°è©±æ­·å² + ç³»çµ±æŒ‡ä»¤                                â”‚           â”‚
â”‚  â”‚  - å®‰å…¨å­˜æ”¾ GEMINI_API_KEY                               â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ 3. å‘¼å« Gemini API
                                    â”‚    (é™„å¸¶ API Key)
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Google Cloud (Gemini API)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Gemini 2.5 Flash                                      â”‚           â”‚
â”‚  â”‚  - ä¸Šä¸‹æ–‡çª—å£: 1,000,000 (1M) Tokens                     â”‚           â”‚
â”‚  â”‚  - ç”Ÿæˆ AI å›æ‡‰                                          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ 4. è¿”å› AI å›æ‡‰
                                    â–¼
                              ä½¿ç”¨è€…ç€è¦½å™¨
```

---

## ğŸ“ æª”æ¡ˆçµæ§‹

```
backend/
â”œâ”€â”€ chat_server.py      # FastAPI ä¸»ç¨‹å¼
â”œâ”€â”€ Dockerfile          # Docker å®¹å™¨è¨­å®š (Python 3.12 + uv)
â”œâ”€â”€ pyproject.toml      # Python ä¾è³´å¥—ä»¶ï¼ˆuv æ ¼å¼ï¼‰
â”œâ”€â”€ requirements.txt    # Python ä¾è³´å¥—ä»¶ï¼ˆpip æ ¼å¼ï¼Œå‚™ç”¨ï¼‰
â””â”€â”€ README.md           # æœ¬æ–‡ä»¶
```

---

## ğŸ¤– ä½¿ç”¨çš„æ¨¡å‹è³‡è¨Šï¼šGemini 2.5 Flash

æœ¬å°ˆæ¡ˆä½¿ç”¨ **Gemini 2.5 Flash** (`gemini-2.5-flash`)ï¼Œé€™æ˜¯ Google ç©©å®šç‰ˆçš„é«˜æ•ˆèƒ½æ¨¡å‹ã€‚

### æ¨¡å‹è¦æ ¼

- **æ¨¡å‹åç¨±**: Gemini 2.5 Flash
- **Context Window (ä¸Šä¸‹æ–‡çª—å£)**: 1,000,000 (100 è¬) Tokens
- **ç‰¹é»**: 
  - ç©©å®šç‰ˆæ¨¡å‹ï¼Œé©åˆç”Ÿç”¢ç’°å¢ƒ
  - é«˜æ•ˆèƒ½ï¼Œé©åˆ RAG æ‡‰ç”¨
  - 100 è¬ tokens è¶³ä»¥æ”¾å…¥æ•¸ç™¾ç¯‡æ•™å­¸æ–‡ç« 

### è²»ç”¨åƒè€ƒ (2026/01)

| é …ç›® | åƒ¹æ ¼ (æ¯ç™¾è¬ Tokens) |
|------|----------------------|
| **Input (è¼¸å…¥)** | **$0.10** |
| **Output (è¼¸å‡º)** | **$0.40** |

### ç›¸é—œé€£çµ

- [Gemini æ¨¡å‹åˆ—è¡¨èˆ‡å®šåƒ¹](https://ai.google.dev/gemini-api/docs/models/gemini)
- [Google AI Studio](https://aistudio.google.com/)

---

## ğŸ”§ chat_server.py é‹ä½œåŸç†

### 1. API ç«¯é»

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| `/` | GET | å¥åº·æª¢æŸ¥ï¼Œå›å‚³ `{"status": "ok"}` |
| `/api/chat` | POST | è™•ç†èŠå¤©è«‹æ±‚ |

### 2. è«‹æ±‚æ ¼å¼

```json
{
  "history": [
    {"role": "user", "parts": [{"text": "ä»€éº¼æ˜¯ Dockerï¼Ÿ"}]},
    {"role": "model", "parts": [{"text": "Docker æ˜¯ä¸€å€‹å®¹å™¨åŒ–å¹³å°..."}]}
  ],
  "message": "å¦‚ä½•å®‰è£ Dockerï¼Ÿ",
  "system_instruction": "ä½ æ˜¯èª²ç¨‹åŠ©æ•™ï¼Œè«‹æ ¹æ“šä»¥ä¸‹é é¢å…§å®¹å›ç­”..."
}
```

| æ¬„ä½ | èªªæ˜ |
|------|------|
| `history` | å®Œæ•´å°è©±æ­·å²ï¼ˆç„¡ç‹€æ…‹è¨­è¨ˆï¼‰ |
| `message` | ä½¿ç”¨è€…çš„æ–°è¨Šæ¯ |
| `system_instruction` | RAG ä¸Šä¸‹æ–‡ï¼ˆç•¶å‰é é¢å…§å®¹ï¼‰ |

### 3. å›æ‡‰æ ¼å¼

```json
{
  "text": "è¦å®‰è£ Dockerï¼Œè«‹åŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿ..."
}
```

### 4. ç¨‹å¼ç¢¼æµç¨‹

```python
# 1. æ¥æ”¶è«‹æ±‚
@app.post("/api/chat")
async def chat_endpoint(request: ChatRequest):
    
    # 2. è½‰æ›å°è©±æ­·å²æ ¼å¼ï¼ˆuser/bot â†’ user/modelï¼‰
    gemini_history = []
    for msg in request.history:
        role = "user" if msg.role == "user" else "model"
        gemini_history.append({...})
    
    # 3. å»ºç«‹èŠå¤©æœƒè©±
    chat = model.start_chat(history=gemini_history)
    
    # 4. çµ„åˆç³»çµ±æŒ‡ä»¤ + ä½¿ç”¨è€…è¨Šæ¯
    final_message = f"{system_instruction}\n\nUser: {message}"
    
    # 5. ç™¼é€åˆ° Gemini API
    response = chat.send_message(final_message)
    
    # 6. è¿”å›çµæœ
    return {"text": response.text}
```

---

## ğŸ§  RAG æç¤ºè©èˆ‡æ–‡ç« ä¸²æ¥æµç¨‹

æœ¬èŠå¤©æ©Ÿå™¨äººä½¿ç”¨ **RAGï¼ˆRetrieval-Augmented Generationï¼‰** æŠ€è¡“ï¼Œå°‡ç•¶å‰é é¢å…§å®¹ä½œç‚ºä¸Šä¸‹æ–‡å‚³éçµ¦ AIï¼Œè®“å›ç­”æ›´ç²¾æº–ã€‚

### RAG è³‡æ–™æµç¨‹

```mermaid
sequenceDiagram
    participant U as ä½¿ç”¨è€…
    participant F as å‰ç«¯ (chatbot.js)
    participant B as å¾Œç«¯ (FastAPI)
    participant G as Gemini API

    U->>F: 1. è¼¸å…¥å•é¡Œ
    F->>F: 2. æ“·å–ç•¶å‰é é¢å…§å®¹<br/>(.md-content)
    F->>F: 3. çµ„åˆç³»çµ±æç¤ºè©<br/>+ é é¢å…§å®¹ + å•é¡Œ
    F->>B: 4. POST /api/chat<br/>{history, message, system_instruction}
    B->>B: 5. è½‰æ›å°è©±æ­·å²æ ¼å¼
    B->>B: 6. åˆä½µ system_instruction + message
    B->>G: 7. å‘¼å« Gemini API
    G->>B: 8. AI å›æ‡‰
    B->>F: 9. è¿”å› {text: "..."}
    F->>U: 10. é¡¯ç¤ºå›ç­”
```

### å®Œæ•´ System Prompt ç¯„ä¾‹ï¼ˆv2.0 - å…¨ç«™é è¼‰ç‰ˆï¼‰

> âš ï¸ **v2.0 æ›´æ–°**ï¼šç¾åœ¨ä½¿ç”¨ `content.json` é è¼‰å…¨ç«™æ–‡ä»¶ï¼Œè€Œéåƒ…æŠ“å–ç•¶å‰é é¢ã€‚

å‰ç«¯ `chatbot.js` æœƒåœ¨ä½¿ç”¨è€…é–‹å•ŸèŠå¤©è¦–çª—æ™‚ï¼Œè¼‰å…¥ `content.json` ä¸¦çµ„åˆä»¥ä¸‹ç³»çµ±æç¤ºè©ï¼š

```javascript
// è¼‰å…¥å…¨ç«™æ–‡ä»¶
const res = await fetch('./content.json');
const data = await res.json();

// çµ„åˆæˆ DOCUMENTATION å­—ä¸²
allDocsContent = data
  .map(doc => `Page: ${doc.title}\nURL: ${doc.url}\nContent:\n${doc.content}`)
  .join("\n\n---\n\n");

// ç³»çµ±æç¤ºè©
const systemInstruction = `ä½ æ˜¯ DCKA èª²ç¨‹ï¼ˆDocker Containers èˆ‡ Kubernetes ç³»çµ±ç®¡ç†ï¼‰çš„ AI åŠ©æ•™ã€‚

## å›ç­”è¦å‰‡
1. **èªè¨€**ï¼šä½¿ç”¨ç¹é«”ä¸­æ–‡å›ç­”
2. **é€£çµ**ï¼šç•¶æåˆ°ç›¸é—œä¸»é¡Œæ™‚ï¼Œæä¾›æ–‡ç« çš„ Markdown é€£çµï¼ˆä½¿ç”¨ URL æ¬„ä½ï¼‰
3. **æ ¼å¼**ï¼šä½¿ç”¨æ¸…æ™°çš„ Markdown æ ¼å¼ï¼ˆæ¨™é¡Œã€åˆ—é»ã€ç¨‹å¼ç¢¼å€å¡Šï¼‰
4. **ç²¾æº–**ï¼šå„ªå…ˆä½¿ç”¨æ–‡ä»¶å…§å®¹å›ç­”ï¼Œå¦‚æœæ²’æœ‰ç›¸é—œå…§å®¹æ‰ç”¨ä¸€èˆ¬çŸ¥è­˜
5. **ç¨‹å¼ç¢¼**ï¼šæä¾›å¯åŸ·è¡Œçš„å‘½ä»¤ç¯„ä¾‹æ™‚ï¼Œä½¿ç”¨ \`\`\`bash æ ¼å¼

## é€£çµæ ¼å¼ç¯„ä¾‹
ç•¶æåˆ°æŸå€‹ä¸»é¡Œæ™‚ï¼Œé€™æ¨£æä¾›é€£çµï¼š
- æƒ³äº†è§£æ›´å¤šï¼Œè«‹åƒè€ƒ [LAB 02 å®‰è£ Docker](/lab02_docker_install/)
- è©³ç´°æ­¥é©Ÿè«‹è¦‹ [Private Registry å»ºç½®](/lab05_private_registry/)

## èª²ç¨‹æ–‡ä»¶
ä»¥ä¸‹æ˜¯å®Œæ•´çš„èª²ç¨‹æ–‡ä»¶å…§å®¹ï¼Œè«‹æ ¹æ“šé€™äº›å…§å®¹å›ç­”ï¼š

---
${allDocsContent}  // â† å…¨ç«™ 24 å€‹é é¢çš„å®Œæ•´å…§å®¹
---`;
```

### content.json ç”Ÿæˆæ©Ÿåˆ¶

`content.json` ç”± MkDocs Hook è‡ªå‹•ç”Ÿæˆï¼š

```
hooks/
â””â”€â”€ generate_content.py  # åœ¨ mkdocs build æ™‚è‡ªå‹•åŸ·è¡Œ
```

**ç”Ÿæˆæµç¨‹ï¼š**

1. `mkdocs build` æˆ– `mkdocs gh-deploy` åŸ·è¡Œ
2. Hook `on_post_build()` è‡ªå‹•è§¸ç™¼
3. æƒæ `docs/` ç›®éŒ„ä¸‹æ‰€æœ‰ `.md` æª”æ¡ˆ
4. è¼¸å‡º `site/content.json`

### æç¤ºè©çµ„æˆçµæ§‹

| çµ„æˆéƒ¨åˆ† | ä¾†æº | èªªæ˜ |
|----------|------|------|
| **è§’è‰²è¨­å®š** | å¯«æ­»åœ¨ç¨‹å¼ç¢¼ | "ä½ æ˜¯ DCKA èª²ç¨‹çš„ AI åŠ©æ•™" |
| **å›ç­”è¦å‰‡** | å¯«æ­»åœ¨ç¨‹å¼ç¢¼ | ç¹é«”ä¸­æ–‡ã€æä¾›é€£çµã€æ ¼å¼è¦æ±‚ |
| **å…¨ç«™æ–‡ä»¶** | `content.json` (å‹•æ…‹è¼‰å…¥) | 24 å€‹é é¢çš„å®Œæ•´ Markdown å…§å®¹ |
| **å°è©±æ­·å²** | sessionStorage | ä¿æŒå°è©±ä¸Šä¸‹æ–‡é€£è²« |

### å¾Œç«¯å¦‚ä½•è™•ç†æç¤ºè©

```python
# chat_server.py ç¬¬ 77-80 è¡Œ
final_message = request.message
if request.system_instruction:
    # å°‡ RAG ä¸Šä¸‹æ–‡èˆ‡ä½¿ç”¨è€…å•é¡Œåˆä½µ
    final_message = f"{request.system_instruction}\n\nUser Question: {request.message}"
```

---

## ğŸ”„ CI/CDï¼šRailway èˆ‡ GitHub äº’å‹•æµç¨‹

```mermaid
flowchart TB
    subgraph GitHub
        GH_Repo[("ğŸ“¦ dcka-class-notes<br/>Repository")]
        GH_Main["main branch"]
        GH_Pages["gh-pages branch"]
    end

    subgraph é–‹ç™¼è€…æœ¬æ©Ÿ
        DEV["ğŸ’» é–‹ç™¼ç’°å¢ƒ"]
    end

    subgraph Railway
        RW_Service["âš¡ FastAPI æœå‹™<br/>backend/"]
        RW_Build["ğŸ”¨ è‡ªå‹•å»ºç½®"]
        RW_Deploy["ğŸš€ è‡ªå‹•éƒ¨ç½²"]
    end

    subgraph GitHub_Pages
        GP["ğŸŒ éœæ…‹ç¶²ç«™<br/>caocharles.github.io"]
    end

    DEV -->|"1. git push"| GH_Main
    GH_Main -->|"2. Webhook è§¸ç™¼"| RW_Build
    RW_Build -->|"3. Docker Build"| RW_Deploy
    RW_Deploy -->|"4. å¾Œç«¯ä¸Šç·š"| RW_Service

    DEV -->|"5. mkdocs gh-deploy"| GH_Pages
    GH_Pages -->|"6. è‡ªå‹•ç™¼å¸ƒ"| GP

    GP <-->|"7. API è«‹æ±‚"| RW_Service

    style GH_Repo fill:#24292e,color:#fff
    style RW_Service fill:#0B0D0E,color:#fff
    style GP fill:#2ea44f,color:#fff
```

### éƒ¨ç½²æµç¨‹èªªæ˜

| æ­¥é©Ÿ | å‹•ä½œ | èªªæ˜ |
|------|------|------|
| 1 | `git push` | æ¨é€ç¨‹å¼ç¢¼åˆ° GitHub main åˆ†æ”¯ |
| 2 | Webhook | Railway åµæ¸¬åˆ°è®Šæ›´è‡ªå‹•è§¸ç™¼ |
| 3 | Docker Build | Railway åŸ·è¡Œ `backend/Dockerfile` |
| 4 | è‡ªå‹•éƒ¨ç½² | å¾Œç«¯æœå‹™æ›´æ–°ä¸Šç·š |
| 5 | `mkdocs gh-deploy` | å»ºç½®ä¸¦æ¨é€åˆ° gh-pages åˆ†æ”¯ |
| 6 | GitHub Pages | è‡ªå‹•ç™¼å¸ƒéœæ…‹ç¶²ç«™ |
| 7 | API è«‹æ±‚ | å‰ç«¯é€é HTTPS å‘¼å«å¾Œç«¯ API |

---

## ğŸš€ æœ¬åœ°é–‹ç™¼

### 1. è¨­å®šç’°å¢ƒè®Šæ•¸

åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹ `.env` æª”æ¡ˆï¼š

```
GEMINI_API_KEY=your_api_key_here
```

> ğŸ“Œ **å–å¾— API Key**ï¼šå‰å¾€ [Google AI Studio](https://aistudio.google.com/apikey) å»ºç«‹

### 2. å•Ÿå‹•å¾Œç«¯æœå‹™

```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨ uvï¼ˆå¾å°ˆæ¡ˆæ ¹ç›®éŒ„ï¼‰
uv run uvicorn backend.chat_server:app --reload --port 8001

# æ–¹æ³• 2ï¼šé€²å…¥ backend ç›®éŒ„
cd backend
pip install -r requirements.txt
uvicorn chat_server:app --reload --port 8001
```

### 3. æ¸¬è©¦ API

```bash
# å¥åº·æª¢æŸ¥
curl http://localhost:8001/

# æ¸¬è©¦èŠå¤©
curl -X POST http://localhost:8001/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "history": [],
    "message": "ä»€éº¼æ˜¯ Dockerï¼Ÿ",
    "system_instruction": ""
  }'
```

---

## â˜ï¸ éƒ¨ç½²åˆ° Railwayï¼ˆå…è²»æ–¹æ¡ˆï¼‰

Railway æä¾›æ¯æœˆ **$5 å…è²»é¡åº¦**ï¼Œé©åˆå€‹äººå°ˆæ¡ˆä½¿ç”¨ã€‚

### Step 1ï¼šå»ºç«‹ Railway å¸³è™Ÿ

1. å‰å¾€ [Railway.app](https://railway.app/)
2. ä½¿ç”¨ GitHub å¸³è™Ÿç™»å…¥

### Step 2ï¼šå»ºç«‹æ–°å°ˆæ¡ˆ

1. é»é¸ **New Project**
2. é¸æ“‡ **Deploy from GitHub repo**
3. é¸æ“‡ä½ çš„ `dcka-class-notes` Repository
4. æˆæ¬Š Railway å­˜å–

### Step 3ï¼šè¨­å®šéƒ¨ç½²ç›®éŒ„

Railway é è¨­æœƒéƒ¨ç½²æ•´å€‹ Repositoryï¼Œä½†æˆ‘å€‘åªéœ€è¦ `backend` ç›®éŒ„ï¼š

1. é€²å…¥å°ˆæ¡ˆ **Settings**
2. æ‰¾åˆ° **Root Directory**
3. è¨­å®šç‚ºï¼š`backend`

![Railway Root Directory è¨­å®š](https://docs.railway.app/assets/images/root-directory.png)

### Step 4ï¼šè¨­å®šç’°å¢ƒè®Šæ•¸

1. é€²å…¥å°ˆæ¡ˆ **Variables** æ¨™ç±¤
2. é»é¸ **New Variable**
3. æ–°å¢ï¼š

| Variable | Value |
|----------|-------|
| `GEMINI_API_KEY` | `your_api_key_here` |

### Step 5ï¼šç¢ºèªå•Ÿå‹•æŒ‡ä»¤

Railway æœƒè‡ªå‹•åµæ¸¬ Dockerfileï¼Œä½†ä½ ä¹Ÿå¯ä»¥æ‰‹å‹•è¨­å®šï¼š

1. é€²å…¥ **Settings** â†’ **Deploy**
2. ç¢ºèª Start Commandï¼š

```bash
uvicorn chat_server:app --host 0.0.0.0 --port $PORT
```

### Step 6ï¼šéƒ¨ç½²ä¸¦å–å¾— URL

1. Railway æœƒè‡ªå‹•é–‹å§‹éƒ¨ç½²
2. éƒ¨ç½²å®Œæˆå¾Œï¼Œé»é¸ **Settings** â†’ **Networking**
3. é»é¸ **Generate Domain** å–å¾—å…¬é–‹ç¶²å€

æœ¬å°ˆæ¡ˆç¶²å€ï¼š`https://dcka-class-notes-production.up.railway.app`

### Step 7ï¼šæ›´æ–°å‰ç«¯ API URL

ç·¨è¼¯ `docs/assets/js/chatbot.js`ï¼Œå°‡ç¬¬ 47 è¡Œæ”¹ç‚ºï¼š

```javascript
// ä¿®æ”¹å‰ï¼ˆæœ¬åœ°é–‹ç™¼ï¼‰
window.BACKEND_API_URL = window.BACKEND_API_URL || "http://localhost:8001";

// ä¿®æ”¹å¾Œï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰
window.BACKEND_API_URL = window.BACKEND_API_URL || "https://dcka-class-notes-production.up.railway.app";
```

### Step 8ï¼šé‡æ–°éƒ¨ç½² GitHub Pages

```bash
uv run mkdocs gh-deploy --force
```

---

## ğŸ’° Railway å…è²»é¡åº¦èªªæ˜

| é …ç›® | å…è²»é¡åº¦ |
|------|----------|
| æ¯æœˆåŸ·è¡Œæ™‚é–“ | 500 å°æ™‚ |
| æ¯æœˆè²»ç”¨ | $5 |
| RAM | 512 MB |
| vCPU | å…±äº« |

> âš ï¸ **æ³¨æ„**ï¼šå…è²»æ–¹æ¡ˆçš„æœå‹™æœƒåœ¨é–’ç½®æ™‚ã€Œç¡çœ ã€ï¼Œé¦–æ¬¡è«‹æ±‚å¯èƒ½éœ€è¦å¹¾ç§’é˜å–šé†’ã€‚

### é™ä½ä½¿ç”¨é‡çš„æŠ€å·§

1. **ä½¿ç”¨ Starter Plan**ï¼šæ–°å¸³è™Ÿè‡ªå‹•ç²å¾— $5 é¡åº¦
2. **æœå‹™æœƒè‡ªå‹•ç¡çœ **ï¼šé–’ç½®æ™‚ä¸æ¶ˆè€—è³‡æº
3. **ç›£æ§ä½¿ç”¨é‡**ï¼šåœ¨ Dashboard æŸ¥çœ‹æ¯æœˆæ¶ˆè€—

---

## ğŸ”’ å®‰å…¨æ€§è€ƒé‡

### CORS è¨­å®š

ç›®å‰ `chat_server.py` è¨­å®šç‚ºå…è¨±æ‰€æœ‰ä¾†æºï¼ˆé–‹ç™¼æ–¹ä¾¿ï¼‰ï¼š

```python
allow_origins=["*"]  # é–‹ç™¼ç’°å¢ƒ
```

**ç”Ÿç”¢ç’°å¢ƒå»ºè­°**ï¼šé™åˆ¶åªå…è¨±ä½ çš„ç¶²ç«™ï¼š

```python
allow_origins=[
    "https://caocharles.github.io",
    "http://localhost:8000"
]
```

### API Key ä¿è­·

- âœ… API Key å­˜æ”¾åœ¨ Railway ç’°å¢ƒè®Šæ•¸ä¸­
- âœ… ä¸ç´å…¥ Git ç‰ˆæ§ï¼ˆåœ¨ `.gitignore` ä¸­ï¼‰
- âœ… å‰ç«¯ç„¡æ³•ç›´æ¥å­˜å– API Key

---

## ğŸ› ç–‘é›£æ’è§£

### Q1: Railway é¡¯ç¤º "Build Failed"

**åŸå› **ï¼šå¯èƒ½æ˜¯ Dockerfile æˆ– requirements.txt å•é¡Œ

**è§£æ±º**ï¼š
1. æª¢æŸ¥ Railway çš„ Build Logs
2. ç¢ºèª `requirements.txt` å¥—ä»¶åç¨±æ­£ç¢º
3. æœ¬åœ°å…ˆæ¸¬è©¦ Docker å»ºç½®ï¼š

```bash
cd backend
docker build -t test-backend .
docker run -p 8001:8000 -e GEMINI_API_KEY=xxx test-backend
```

### Q2: å‰ç«¯é¡¯ç¤º "CORS Error"

**åŸå› **ï¼šå¾Œç«¯ CORS è¨­å®šæœªåŒ…å«å‰ç«¯ç¶²å€

**è§£æ±º**ï¼šä¿®æ”¹ `chat_server.py` çš„ `allow_origins`

### Q3: Railway æœå‹™å›æ‡‰å¾ˆæ…¢

**åŸå› **ï¼šå…è²»æ–¹æ¡ˆæœå‹™æœƒç¡çœ 

**è§£æ±º**ï¼š
- é€™æ˜¯æ­£å¸¸ç¾è±¡ï¼Œé¦–æ¬¡è«‹æ±‚éœ€è¦å–šé†’
- å‡ç´šä»˜è²»æ–¹æ¡ˆå¯é¿å…ç¡çœ 

### Q4: Gemini API è¿”å›éŒ¯èª¤

**åŸå› **ï¼šAPI Key ç„¡æ•ˆæˆ–é…é¡ç”¨ç›¡

**è§£æ±º**ï¼š
1. ç¢ºèª Railway ç’°å¢ƒè®Šæ•¸è¨­å®šæ­£ç¢º
2. åˆ° Google AI Studio æª¢æŸ¥ API ä½¿ç”¨ç‹€æ³
3. ç¢ºèª API Key æœªéæœŸ

---

## ğŸ“š ç›¸é—œè³‡æº

- [FastAPI å®˜æ–¹æ–‡ä»¶](https://fastapi.tiangolo.com/)
- [Railway å®˜æ–¹æ–‡ä»¶](https://docs.railway.app/)
- [Google Gemini API æ–‡ä»¶](https://ai.google.dev/gemini-api/docs)
- [Uvicorn å®˜æ–¹æ–‡ä»¶](https://www.uvicorn.org/)
